apiVersion: batch/v1
kind: Job
metadata:
  name: integration-tests
spec:
  backoffLimit: 0
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: tester
          image: curlimages/curl:8.8.0
          command: ["/bin/sh","-lc"]
          args:
            - |
              set -e
              urls="
              http://lugx-service.default.svc.cluster.local/
              http://game-service-svc.default.svc.cluster.local/healthz
              http://game-service-svc.default.svc.cluster.local/metrics
              http://order-service-svc.default.svc.cluster.local/healthz
              http://order-service-svc.default.svc.cluster.local/metrics
              http://analytics-service-svc.default.svc.cluster.local/healthz
              http://analytics-service-svc.default.svc.cluster.local/metrics
              "
              fail=0
              for u in $urls; do
                code=$(curl -sS -o /dev/null -w "%{http_code}" --max-time 10 "$u" || true)
                echo "$u -> $code"
                [ "$code" = "200" ] || fail=1
              done
              exit $fail
